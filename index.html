<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Beagle</title>
<style>
  body {
    margin: 0;
    background: #0d1117;
    color: #39ff14;
    font-family: 'Orbitron', sans-serif;
    text-align: center;
  }
  #micSelect, button {
    margin: 10px;
    font-size: 16px;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #39ff14;
    background: #111;
    color: #39ff14;
    cursor: pointer;
  }
  #canvas-container {
    width: 90vw;
    height: 70vh;
    margin: auto;
  }
  canvas {
    width: 100%;
    height: 100%;
    border: 2px solid #39ff14;
    border-radius: 10px;
  }
</style>
</head>
<body>

<h1>AI Beagle üê∂</h1>

<select id="micSelect"></select>
<button id="startBtn">Start Mic</button>

<div id="canvas-container"></div>

<script type="module">

import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.165.0/build/three.module.js';
import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.165.0/examples/jsm/loaders/GLTFLoader.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.165.0/examples/jsm/controls/OrbitControls.js';

let scene, camera, renderer, dog, mixer, jawBones = [];

function initThree() {
  const container = document.getElementById('canvas-container');

  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x0d1117);

  camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
  camera.position.set(0, 1.5, 3);

  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(container.clientWidth, container.clientHeight);
  container.appendChild(renderer.domElement);

  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 1.5);
  hemi.position.set(0, 20, 0);
  scene.add(hemi);

  const dir = new THREE.DirectionalLight(0xffffff, 1);
  dir.position.set(3, 10, 10);
  scene.add(dir);

  // Load your GLTF
  const loader = new GLTFLoader();
  loader.load('scene.gltf', gltf => {
    dog = gltf.scene;
    dog.scale.set(1.5,1.5,1.5);
    scene.add(dog);

    dog.traverse(obj => {
      if(obj.name.toLowerCase().includes("mouth")) jawBones.push(obj);
    });

    if (gltf.animations.length) {
      mixer = new THREE.AnimationMixer(dog);
      gltf.animations.forEach(c => mixer.clipAction(c).play());
    }
  });

  animate();
}

function animate() {
  requestAnimationFrame(animate);
  if (mixer) mixer.update(0.01);

  jawBones.forEach(j => {
    j.rotation.x = Math.sin(Date.now() * 0.01) * 0.2;
  });

  renderer.render(scene, camera);
}

initThree();

// ------ Microphone Code ------

const micSelect = document.getElementById('micSelect');
navigator.mediaDevices.enumerateDevices().then(devices => {
  devices.filter(d => d.kind === 'audioinput').forEach((device, i) => {
    const option = document.createElement('option');
    option.value = device.deviceId;
    option.text = device.label || `Mic ${i+1}`;
    micSelect.appendChild(option);
  });
});

document.getElementById('startBtn').onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({
    audio: { deviceId: micSelect.value }
  });
  alert('Mic started ‚Äî great! Me Beagle is listening! üê∂');
};

</script>

</body>
</html>
