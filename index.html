<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Beagle</title>
<style>
  body {
    margin: 0;
    background: #0a0a0a; /* dark background */
    color: #00ff99; /* neon green text */
    font-family: 'Orbitron', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }
  #dog-container {
    width: 600px;
    height: 600px;
    background: #111;
    border: 2px solid #00ff99;
    border-radius: 10px;
  }
  #controls {
    margin-top: 20px;
  }
  button, select {
    background: #111;
    color: #00ff99;
    border: 1px solid #00ff99;
    padding: 5px 10px;
    font-size: 16px;
    border-radius: 5px;
    margin: 5px;
  }
</style>
</head>
<body>

<h1>Talk to Your AI Beagle</h1>
<div id="dog-container"></div>

<div id="controls">
  <select id="micSelect"></select>
  <button id="startBtn">Start Talking</button>
</div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js';
import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/loaders/GLTFLoader.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/controls/OrbitControls.js';

// Scene setup
const container = document.getElementById('dog-container');
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
camera.position.set(0, 1.5, 3);

const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
renderer.setSize(container.clientWidth, container.clientHeight);
container.appendChild(renderer.domElement);

const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

// Light
const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
light.position.set(0, 10, 0);
scene.add(light);

// Load GLTF dog
let dog, mouthBone;
const loader = new GLTFLoader();
loader.load('./dog.gltf', gltf => {
  dog = gltf.scene;
  scene.add(dog);

  // Try to find a mouth bone for animation
  dog.traverse(child => {
    if (child.name.toLowerCase().includes('mouth')) {
      mouthBone = child;
    }
  });
}, undefined, error => {
  console.error(error);
});

// Animate
function animate() {
  requestAnimationFrame(animate);
  if (dog) dog.rotation.y += 0.005; // slight rotation
  controls.update();
  renderer.render(scene, camera);
}
animate();

// Microphone selection
const micSelect = document.getElementById('micSelect');
navigator.mediaDevices.enumerateDevices().then(devices => {
  devices.filter(d => d.kind === 'audioinput').forEach((device, i) => {
    const option = document.createElement('option');
    option.value = device.deviceId;
    option.text = device.label || `Mic ${i+1}`;
    micSelect.appendChild(option);
  });
});

const startBtn = document.getElementById('startBtn');
startBtn.onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: { deviceId: micSelect.value }});
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  const source = audioContext.createMediaStreamSource(stream);

  // Simple mouth animation while talking
  const analyser = audioContext.createAnalyser();
  source.connect(analyser);
  analyser.fftSize = 256;
  const dataArray = new Uint8Array(analyser.frequencyBinCount);

  function mouthMove() {
    requestAnimationFrame(mouthMove);
    analyser.getByteFrequencyData(dataArray);
    const avg = dataArray.reduce((a,b)=>a+b,0)/dataArray.length;
    if (mouthBone) mouthBone.scale.y = 1 + avg/150; // simple open/close
  }
  mouthMove();
  alert('Your AI Beagle is listening! Start talking.');
};
</script>
</body>
</html>
